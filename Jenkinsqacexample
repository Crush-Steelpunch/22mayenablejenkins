pipeline {
    agent any
    stages {
        stage('Stage 1') {
            steps {
                // Clone https://gitlab.com/qacdevops/chaperootodo_client, 
                // making sure it doesn't already exist.

                // sh 'git clone <repo>'  If we do this the git clone will 
                // complain about an existing directory

                git 'https://gitlab.com/qacdevops/chaperootodo_client'
            
            }
        }
        stage('Stage 2') {
            steps {
                //Install Docker and Docker-Compose.
                // JENKINS IS CI/CD NOT DEPLOYMENT OR CONFIG
                // Need to have admin privs. i.e. set up sudo for jenkins

                sh '''#!/bin/bash
                curl https://get.docker.com | sudo bash
                curl -SL https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
                '''
                
            }
        }
        stage('Stage 3') {
            steps {
                //Deploy the application, using sudo docker-compose pull && 
                //sudo -E DB_PASSWORD=${DB_PASSWORD} docker-compose up -d.
                sh 'sudo docker-compose pull && sudo -E DB_PASSWORD=${DB_PASSWORD} docker-compose up -d'

            }
        }
    }
}